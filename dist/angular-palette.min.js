/**
 * angular-palette  
 * 
 * @version v 0.1.0 - 2013-06-21
 * @link https://github.com/DerekRies/angular-palette
 * @author Derek Ries
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("palette",["ngSanitize","templates-main"]).factory("paletteService",[function(){var a=[];return{subscribedMethod:void 0,exportCommands:function(b){"undefined"!=typeof this.subscribedMethod&&this.subscribedMethod(b,a),a=b},getCommands:function(){return a},subscribe:function(a){this.subscribedMethod=a}}}]).directive("drBlur",function(){return function(a,b,c){b.bind("blur",function(){a.$apply(c.drBlur)})}}).directive("drFocusOn",[function(){return{restrict:"A",link:function(a,b,c){c.$observe("drFocusOn",function(a){"true"===a&&setTimeout(function(){b[0].focus()},100)})}}}]).directive("drScrollToContain",function(){return{restrict:"A",link:function(a,b,c){c.$observe("drScrollToContain",function(a){"true"===a&&b[0].scrollIntoView(!1)})}}}).directive("drKeydown",["$parse",function(a){return{restrict:"A",link:function(b,c,d){c.bind("keydown",function(c){b.$apply(function(){a(d.drKeydown)(b,{$event:c})})})}}}]).filter("drHighlight",function(){function a(a,b,c,d,e){return[b.slice(0,a),c,b.slice(a,a+e),d,b.slice(a+e)].join("")}return function(b,c){if("undefined"!=typeof c&&""!==c){var d=b.toLowerCase().indexOf(c);if(-1!==d)return a(d,b,'<span class="palettematch">',"</span>",c.length)}return b}}).directive("palette",["$timeout","$location","$route","paletteService",function(a,b,c,d){return{restrict:"EA",replace:!0,scope:{},templateUrl:"angular-palette/palette.tpl.html",link:function(a){Mousetrap.bindGlobal(["ctrl+shift+l","command+shift+l"],function(){a.visible?a.$apply(function(){a.close()}):a.$apply(function(){a.open()})})},controller:["$scope",function(e){function f(){for(var a in c.routes){var b=c.routes[a];"undefined"!=typeof b.name&&e.commands.push({name:"Goto: "+b.name,cmd:"link",data:a})}}function g(a){e.commands.splice(-a.length,a.length)}function h(a){e.commands.push.apply(e.commands,a)}var i=13,j=38,k=40,l=27;e.visible=!1,e.commands=[],d.subscribe(function(a,b){g(b),h(a)}),e.activeCmd=0,f(),e.paletteInputKeyHandler=function(a){a.keyCode===j?(a.preventDefault(),e.moveSelectUp()):a.keyCode===k?(a.preventDefault(),e.moveSelectDown()):a.keyCode===l?e.close():a.keyCode===i?e.finish():e.activeCmd=0},e.moveSelectUp=function(){e.activeCmd>0?e.activeCmd--:e.activeCmd=e.filteredCommands.length-1},e.moveSelectDown=function(){e.activeCmd<e.filteredCommands.length-1?e.activeCmd++:e.activeCmd=0},e.finish=function(){e.visible&&(e.useSelection(e.filteredCommands[e.activeCmd]),e.close())},e.close=function(){a(function(){e.visible=!1},1)},e.open=function(){e.query="",e.visible=!0,e.activeCmd=0},e.useSelection=function(a){if("undefined"==typeof a)e.parseTextCommand(e.query);else try{"function"==typeof a.cmd?a.cmd(a.data):e[a.cmd](a.data)}catch(b){console.log("missing a command")}},e.link=function(a){b.path(a)},e.extLink=function(a){window.location=a},e.parseTextCommand=function(a){if(":"===a[0]){var b=parseInt(a.slice(1),10);window.scrollTo(0,b)}}}]}}]),angular.module("templates-main",["angular-palette/palette.tpl.html"]),angular.module("angular-palette/palette.tpl.html",[]).run(["$templateCache",function(a){a.put("angular-palette/palette.tpl.html",'<div class="palette-body" ng-class="{palettevisible: visible}">\n    <div class="palette-inner">\n        <input type="text" class="palette-input" ng-model="query.name"\n            dr-blur="close()" dr-focus-on="{{visible}}" dr-keydown="paletteInputKeyHandler($event)">\n        <div class="palette-results" ng-show="filteredCommands.length">\n            <div class="palette-item"\n                ng-repeat="command in (filteredCommands = (commands | orderBy: \'name\'| filter:query ))"\n                ng-class="{selected: $index == activeCmd}"\n                ng-bind-html-unsafe="command.name | drHighlight:query.name"\n                dr-scroll-to-contain="{{$index == activeCmd}}"\n                ng-click="useSelection(command)">\n            </div>\n        </div>\n    </div>\n</div>\n')}]);